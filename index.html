 <!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christian Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        :root {
            --primary-font: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --background-color: #f4f6f8;
            --card-background-default: #ffffff; 
            --card-bg-1: #f0eaff; --card-bg-2: #fff9e0; --card-bg-3: #e6ffed; --card-bg-4: #ffe6e6;
            --text-color-primary: #333333; --text-color-secondary: #777777;
            --accent-color: #5D3FD3; /* Purple for sign-up button and active states */
            --accent-color-rgb: 93, 63, 211; /* RGB for rgba() backgrounds */
            --accent-color-cta: #ff7043;
            --buy-button-bg: #333; --buy-button-text: #ffffff;
            --border-color: #e0e0e0; --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --icon-color: #555; --disabled-input-bg: #e9ecef;
            --bottom-nav-height: 70px; 
            --avatar-bg: #FFE0B2; 
            --avatar-icon-color: #E67E22; 
        }
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--primary-font); line-height: 1.6; color: var(--text-color-primary);
            background-color: var(--background-color); display: flex; flex-direction: column;
            min-height: 100vh; 
            padding-bottom: var(--bottom-nav-height); 
            transition: padding-bottom 0.3s ease-in-out;
        }
        body.modal-open {
            overflow: hidden;
        }
        body.no-bottom-padding {
            padding-bottom: 0 !important;
        }

        .container { width: 95%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        header {
            background: var(--card-background-default); padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 990; 
        }
        header .container { display: flex; justify-content: space-between; align-items: center; }
        header .store-title { font-size: 1.5rem; font-weight: 600; color: var(--text-color-primary); }
        header .header-icons { display: flex; gap: 18px; align-items: center; }
        header .header-icons .icon-btn {
            font-size: 1.2rem; color: var(--icon-color); background: none;
            border: none; cursor: pointer; position: relative;
        }
        header .header-icons .icon-btn .badge {
            position: absolute; top: -5px; right: -8px; background-color: var(--accent-color-cta);
            color: white; font-size: 0.65rem; padding: 1px 4px; border-radius: 50%; font-weight: bold;
        }
        .grid-toggle-icon { font-size: 1.4rem !important; }
        main { flex: 1; padding-top: 20px; }
        .section-title-main { font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; color: var(--text-color-primary); }
        #categories-section { margin-bottom: 25px; }
        #categories-container {
            display: flex; flex-wrap: nowrap; gap: 10px; overflow-x: auto;
            padding-bottom: 10px; -webkit-overflow-scrolling: touch;
        }
        #categories-container::-webkit-scrollbar { display: none; }
        #categories-container { -ms-overflow-style: none; scrollbar-width: none; }
        .category-btn {
            background-color: var(--card-background-default); color: var(--text-color-secondary);
            border: 1px solid var(--border-color); padding: 7px 15px; border-radius: 18px;
            cursor: pointer; transition: all 0.3s ease; font-weight: 500;
            font-size: 0.85rem; white-space: nowrap; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .category-btn:hover { border-color: var(--accent-color); color: var(--accent-color); }
        .category-btn.active {
            background-color: var(--accent-color); color: var(--card-background-default);
            border-color: var(--accent-color);
        }
        #products-section-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 15px; color: var(--text-color-primary); }
        #products-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .product-card {
            background: var(--card-background-default); border-radius: 15px; box-shadow: var(--shadow);
            overflow: hidden; display: flex; flex-direction: column; transition: transform 0.2s ease-in-out;
        }
        .product-card:hover { transform: translateY(-3px); }
        .product-card .product-image-container {
            position: relative; padding: 15px 15px 5px 15px; display: flex;
            justify-content: center; align-items: center; height: 130px; cursor: pointer;
        }
        .product-card img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .product-card .wishlist-icon {
            position: absolute; top: 10px; right: 10px; font-size: 1rem;
            color: var(--text-color-secondary); background-color: rgba(255, 255, 255, 0.8);
            width: 28px; height: 28px; display: flex; justify-content: center;
            align-items: center; border-radius: 50%; cursor: pointer; transition: color 0.2s;
        }
        .product-card .wishlist-icon.active { color: #ff4b4b; }
        .product-card-content { padding: 0px 12px 12px 12px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-card-content h3.product-title {
            font-size: 0.9rem; font-weight: 500; margin-bottom: 4px; color: var(--text-color-primary);
            line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
            overflow: hidden; text-overflow: ellipsis; min-height: 1.3em; cursor: pointer;
        }
        .product-info-bottom { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .product-card-content .product-price { font-weight: 600; color: var(--text-color-primary); font-size: 0.95rem; }
        .product-card-content .buy-btn {
            background-color: var(--buy-button-bg); color: var(--buy-button-text); border: none;
            padding: 5px 12px; border-radius: 15px; cursor: pointer; font-size: 0.75rem;
            font-weight: 500; transition: background-color 0.2s;
        }
        .product-card-content .buy-btn:hover { background-color: lighten(var(--buy-button-bg), 10%); }
        
        /* --- Modal Styles --- */
        .modal { 
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; bottom: var(--bottom-nav-height); 
            background-color: rgba(0,0,0,0.5);
            overflow: hidden; 
        }
        .modal#productDetailModal,
        .modal#authModal { 
            bottom: 0; 
        }

        .modal-content { 
            background-color: var(--background-color); width: 100%; height: 100%; 
            display: flex; flex-direction: column;
            animation: slideUp 0.3s ease-out;
            border-radius: 0; box-shadow: none;
        }
        #settingsModal .modal-content,
        #authModal .modal-content { 
            background-color: var(--background-color); 
        }

        @keyframes slideUp { 
            from { transform: translateY(100%); opacity: 0.7; } 
            to { transform: translateY(0); opacity: 1; } 
        }
        
        .modal-header {
            display: flex; 
            align-items: center;
            padding: 12px 15px; background-color: var(--card-background-default);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            flex-shrink: 0; 
            position: relative; 
        }
        .modal-header .modal-title { 
            font-size: 1.1rem; font-weight: 600; 
            flex-grow: 1; 
            text-align: center; 
        }
        .modal-header .back-btn { 
            font-size: 1.2rem; color: var(--icon-color); background: none; border: none; cursor: pointer;
            position: absolute; 
            left: 15px; 
        }
        .modal-header .cart-btn-modal { 
            font-size: 1.2rem; color: var(--icon-color); background: none; border: none; cursor: pointer;
            position: absolute; 
            right: 15px;
        }
        #myOrdersModal .modal-header .modal-title,
        #settingsModal .modal-header .modal-title,
        #authModal .modal-header .modal-title { 
        }
        
        .modal-body { 
            flex-grow: 1; overflow-y: auto; padding: 0; 
        }
        #productDetailModal .modal-body { padding: 0; }
        #modal-product-info { background-color: var(--card-background-default); }
        #orderFormModal .modal-body, 
        #myOrdersModal .modal-body,
        #authModal .modal-body { 
            padding: 20px; 
        }
        #authModal .modal-body .auth-divider {
            text-align: center;
            margin: 15px 0;
            color: var(--text-color-secondary);
            font-size: 0.9rem;
        }
        #myOrdersModal .modal-body { display: flex; flex-direction: column; }
        #myOrdersModal .modal-body .no-orders { margin: auto; text-align: center; }

        /* --- Settings Modal Specific Styles --- */
        #settingsModal .modal-body { padding: 0; background-color: var(--background-color); }
        .settings-profile-section {
            display: flex; flex-direction: column; align-items: center;
            padding: 25px 20px; background-color: var(--card-background-default);
            margin-bottom: 10px; border-bottom: 1px solid var(--border-color);
        }
        .settings-avatar-container { 
            width: 80px; height: 80px; border-radius: 50%;
            background-color: var(--avatar-bg);
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 20px; overflow: hidden; 
        }
        .settings-avatar-container i.fa-user { font-size: 3rem; color: var(--avatar-icon-color); }
        
        .btn-settings-action { 
            border: none; border-radius: 8px; padding: 12px 20px;
            font-size: 0.95rem; font-weight: 600; cursor: pointer;
            transition: background-color 0.2s;
            width: auto; min-width: 150px; text-align: center;
            margin-bottom: 10px; 
        }
        .btn-signup-settings { 
            background-color: var(--accent-color); color: white;
        }
        .btn-signup-settings:hover { background-color: darken(var(--accent-color), 10%); }
        
        .btn-logout-settings { 
            background-color: #e74c3c; 
            color: white;
        }
        .btn-logout-settings:hover { 
            background-color: #c0392b; 
        }

        .profile-details-text {
            color: var(--text-color-secondary); font-size: 0.85rem;
            text-align: center; margin-top: 5px;
        }
        #loggedInUserInfo { 
            font-weight: 600;
            color: var(--text-color-primary);
            margin-top: 10px;
            word-break: break-all; 
        }
        .settings-actions-section {
            background-color: var(--card-background-default);
            padding-top: 5px; padding-bottom: 5px; 
        }
        .settings-action-item {
            display: flex; align-items: center; padding: 15px 20px;
            background-color: transparent; border: none; 
            border-bottom: 1px solid var(--border-color);
            width: 100%; text-align: left; font-size: 0.95rem; 
            color: var(--text-color-primary); cursor: pointer;
            transition: background-color 0.2s;
        }
        .settings-action-item:last-child { border-bottom: none; }
        .settings-action-item i {
            margin-right: 15px; color: var(--icon-color); 
            font-size: 1.1rem; width: 24px; text-align: center;
        }
        .settings-action-item:hover { background-color: #f0f0f0; }

        /* Product Detail Specific Styles */
        #modal-product-info .product-detail-image-wrapper {
            background-color: #FFFBEB; border-radius: 20px; margin: 15px; padding: 20px;
            display: flex; justify-content: center; align-items: center; min-height: 280px;
        }
        #modal-product-info img.product-detail-image { max-width: 100%; max-height: 250px; object-fit: contain; }
        .product-detail-content { padding: 0 20px 20px 20px; }
        .product-detail-content h3.detail-title { font-size: 1.4rem; font-weight: 600; margin-top: 10px; margin-bottom: 8px; }
        .product-detail-content .detail-price { font-size: 1.6rem; font-weight: 700; color: var(--text-color-primary); margin-bottom: 10px; }
        .product-detail-content .stock-status { font-size: 0.85rem; color: var(--text-color-secondary); margin-bottom: 15px; font-weight: 400; }
        .product-detail-content .stock-status i { color: #28a745; margin-right: 5px;}
        .product-options .option-group { margin-bottom: 15px; }
        .product-options .option-label { font-size: 0.9rem; font-weight: 500; margin-bottom: 8px; display: block; }
        .product-options .option-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .product-options .option-btn {
            padding: 7px 12px; border: 1px solid var(--border-color); border-radius: 8px;
            cursor: pointer; background-color: #f9f9f9; font-size: 0.85rem; color: var(--text-color-secondary);
        }
        .product-options .option-btn.selected { border-color: var(--accent-color-cta); background-color: var(--accent-color-cta); color: white; font-weight: 500; }
        .product-options .color-dot {
            width: 28px; height: 28px; border-radius: 50%; border: 2px solid #fff;
            box-shadow: 0 0 0 1px var(--border-color); cursor: pointer;
        }
        .product-options .color-dot.selected { box-shadow: 0 0 0 2px var(--accent-color-cta); }
        .product-detail-content .description-title { font-size: 1rem; font-weight: 600; margin-top: 20px; margin-bottom: 8px; }
        .product-detail-content .description-text { font-size: 0.85rem; color: var(--text-color-secondary); line-height: 1.7; }
        
        .modal-footer { 
            padding: 15px; background-color: var(--card-background-default); 
            box-shadow: 0 -2px 4px rgba(0,0,0,0.05);
            flex-shrink: 0; 
        }
        .modal-footer .btn-cta {
            display: block; width: 100%; background-color: var(--accent-color-cta); color: white;
            padding: 14px; border: none; border-radius: 10px; font-size: 0.95rem;
            font-weight: 600; text-align: center; cursor: pointer; transition: background-color 0.2s;
            margin-bottom: 10px; 
        }
        .modal-footer .btn-cta:last-child {
            margin-bottom: 0;
        }
        .modal-footer .btn-secondary { 
             background-color: var(--text-color-secondary);
        }
        .modal-footer .btn-secondary:hover {
            background-color: darken(var(--text-color-secondary), 10%);
        }
        .btn-google-signin {
            background-color: #DB4437 !important; /* Google Red */
            color: white !important;
        }
        .btn-google-signin:hover {
            background-color: #C33D2E !important;
        }
        .btn-google-signin i { margin-right: 8px; }


        /* Order Form & Auth Form Specific Styles */
        #orderForm .form-group, 
        #emailAuthForm .form-group { 
            margin-bottom: 15px; 
        }
        #orderForm label,
        #emailAuthForm label { 
            display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem; 
        }
        #orderForm input[type="text"], #orderForm input[type="tel"], 
        #orderForm input[type="number"], #orderForm select, #orderForm textarea,
        #orderForm input[type="email"], /* For order form email */
        #emailAuthForm input[type="email"], 
        #emailAuthForm input[type="password"] { 
            width: 100%; padding: 12px; border: 1px solid var(--border-color);
            border-radius: 8px; font-family: var(--primary-font); font-size: 0.95rem;
            background-color: white;
        }
        #orderForm input:disabled, #orderForm select:disabled, #orderForm textarea:disabled { 
            background-color: var(--disabled-input-bg); cursor: not-allowed; 
        }
        .pincode-status { font-size: 0.8rem; margin-top: 5px; }
        .pincode-status.loading { color: var(--text-color-secondary); }
        .pincode-status.error { color: #dc3545; }
        .pincode-status.success { color: #28a745; }

        #ordersListContainer { padding: 0; } 
        #ordersListContainer .order-item {
            background-color: var(--card-background-default); padding: 15px; margin-bottom: 12px;
            border-radius: 10px; box-shadow: var(--shadow); border-left: 4px solid var(--accent-color);
        }

        /* Enhanced Bottom Navigation Bar Styles */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background-color: var(--card-background-default);
            box-shadow: 0 -3px 8px rgba(0,0,0,0.07); 
            display: flex; justify-content: space-around;
            padding: 5px 0; z-index: 998; 
            height: var(--bottom-nav-height); 
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .bottom-nav.is-hidden {
            transform: translateY(100%); opacity: 0;
            pointer-events: none; 
        }
        .bottom-nav-item {
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            text-decoration: none;
            color: var(--text-color-secondary); 
            font-size: 0.65rem; font-weight: 500; 
            cursor: pointer; flex: 1; padding: 6px 4px; 
            border-radius: 16px; 
            transition: background-color 0.25s ease-in-out, color 0.25s ease-in-out, transform 0.15s ease-in-out;
            position: relative; -webkit-tap-highlight-color: transparent; 
            text-align: center; min-width: 60px; 
        }
        .bottom-nav-item i { font-size: 1.25rem; margin-bottom: 2px; transition: transform 0.2s ease-in-out; }
        .bottom-nav-item span { line-height: 1.2; }
        .bottom-nav-item.active { color: var(--accent-color); background-color: rgba(var(--accent-color-rgb), 0.12); }
        .bottom-nav-item.active i, .bottom-nav-item.active span { color: var(--accent-color); }
        @media (hover: hover) {
            .bottom-nav-item:not(.active):hover { background-color: rgba(var(--accent-color-rgb), 0.05); color: var(--text-color-primary); }
            .bottom-nav-item:not(.active):hover i, .bottom-nav-item:not(.active):hover span { color: var(--text-color-primary); }
            .bottom-nav-item.active:hover { background-color: rgba(var(--accent-color-rgb), 0.18); }
        }
        .bottom-nav-item:active { transform: scale(0.96); background-color: rgba(var(--accent-color-rgb), 0.2); }
        
        /* Desktop Styles */
        @media (min-width: 768px) {
            body { padding-bottom: 0 !important; } 
            .bottom-nav { display: none !important; } 
            .modal { top: 0; left: 0; right: 0; bottom: 0; }
            .modal-content { 
                position: relative; margin: 5% auto; width: 90%; max-width: 480px;
                height: auto !important; max-height: 90vh; 
                border-radius: 15px; box-shadow: var(--shadow);
                animation: none; overflow: auto; 
            }
            .modal-header .modal-title { flex-grow: 0; margin-left: auto; margin-right: auto; }
            .modal-header .back-btn { position: static; margin-right: auto; order: -1; }
            .modal-header .cart-btn-modal { position: static; margin-left: auto; }
            #settingsModal .modal-content,
            #authModal .modal-content { 
                max-width: 420px; 
            }
            #settingsModal .modal-content {max-width: 500px;} 
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <div class="store-title">Online Shop</div>
            <div class="header-icons">
                <button class="icon-btn"><i class="fas fa-search"></i></button>
                <button class="icon-btn"><i class="fas fa-bell"></i><span class="badge hidden">3</span></button>
                <button class="icon-btn" id="headerCartBtn"><i class="fas fa-shopping-bag"></i></button>
                <button class="icon-btn grid-toggle-icon"><i class="fas fa-th-large"></i></button>
            </div>
        </div>
    </header>

    <main class="container">
        <h2 class="section-title-main" id="main-section-title">Recommendations</h2>
        <section id="categories-section"><div id="categories-container"></div></section>
        <section id="products-section">
            <h2 id="products-section-title">All Products</h2>
            <div id="products-container"></div>
        </section>
    </main>

    <!-- Product Detail Modal -->
    <div id="productDetailModal" class="modal">
        <div class="modal-content"> 
            <div class="modal-header">
                <button class="back-btn" onclick="closeModal('productDetailModal')"><i class="fas fa-arrow-left"></i></button>
                <h3 class="modal-title">Details</h3>
                <button class="cart-btn-modal icon-btn" onclick="document.getElementById('headerCartBtn').click()"><i class="fas fa-shopping-bag"></i></button>
            </div>
            <div class="modal-body"><div id="modal-product-info"></div></div>
            <div class="modal-footer"><button id="orderNowFromDetailBtn" class="btn-cta">Add to Cart</button></div>
        </div>
    </div>

    <!-- Order Form Modal -->
    <div id="orderFormModal" class="modal">
        <div class="modal-content">
             <div class="modal-header">
                <button class="back-btn" onclick="closeModal('orderFormModal'); if(document.getElementById('productDetailModal').style.display === 'block') openModal('productDetailModal');"><i class="fas fa-arrow-left"></i></button>
                <h3 class="modal-title">Delivery Details</h3>
            </div>
            <div class="modal-body">
                <form id="orderForm">
                     <input type="hidden" id="formProductId">
                    <div class="form-group">
                        <label for="customerName">Name:</label>
                        <input type="text" id="customerName" name="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="customerMobile">Mobile Number:</label>
                        <input type="tel" id="customerMobile" name="customerMobile" pattern="[0-9]{10}" title="Please enter a valid 10-digit mobile number" required>
                    </div>
                    <div class="form-group"> 
                        <label for="customerEmail">Contact Email (Optional):</label>
                        <input type="email" id="customerEmail" name="customerEmail">
                    </div>
                    <div class="form-group">
                        <label for="customerPincode">Pincode (6 digit):</label>
                        <input type="number" id="customerPincode" name="customerPincode" pattern="[0-9]{6}" title="Please enter a valid 6-digit pincode" required>
                        <div id="pincodeStatus" class="pincode-status"></div>
                    </div>
                    <div class="form-group">
                        <label for="customerPostOffice">Select Post Office:</label>
                        <select id="customerPostOffice" name="customerPostOffice" required disabled>
                            <option value="">-- Select Post Office --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="customerDistrict">District:</label>
                        <input type="text" id="customerDistrict" name="customerDistrict" required readonly>
                    </div>
                     <div class="form-group">
                        <label for="customerState">State:</label>
                        <input type="text" id="customerState" name="customerState" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="customerVillageLandmark">Village:</label>
                        <input type="text" id="customerVillageLandmark" name="customerVillageLandmark" placeholder="E.g., Your Village Name" required>
                    </div>
                    <div class="form-group">
                        <label for="customerFullAddress">House No/Street/area name :</label>
                        <textarea id="customerFullAddress" name="customerFullAddress" rows="2" placeholder="House No, Building, Street Name" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                 <button type="submit" form="orderForm" class="btn-cta">Submit Order</button>
            </div>
        </div>
    </div>

    <!-- My Orders Modal -->
    <div id="myOrdersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">My Orders</h3>
            </div>
            <div class="modal-body"><div id="ordersListContainer"></div></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
            </div>
            <div class="modal-body">
                <div class="settings-profile-section">
                    <div class="settings-avatar-container">
                        <i class="fas fa-user"></i>
                    </div>
                    <button class="btn-settings-action" id="btnAuthAction">Sign up / Login</button>
                    <p class="profile-details-text" id="profileDetailsText">View and update your profile details</p>
                    <p class="profile-details-text" id="loggedInUserInfo" style="display: none;"></p>
                </div>
                <div class="settings-actions-section">
                    <button class="settings-action-item" id="settingsShareBtn">
                        <i class="fas fa-share-alt"></i>
                        <span>Share App</span>
                    </button>
                    <button class="settings-action-item" id="settingsContactBtn">
                        <i class="fas fa-envelope"></i>
                        <span>Contact Us</span>
                    </button>
                    <button class="settings-action-item" id="settingsPrivacyBtn">
                        <i class="fas fa-shield-alt"></i>
                        <span>Privacy Policy</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Email/Password/Google Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="back-btn" onclick="closeModal('authModal')"><i class="fas fa-arrow-left"></i></button>
                <h3 class="modal-title">Login / Sign Up</h3>
            </div>
            <div class="modal-body">
                <form id="emailAuthForm">
                    <div class="form-group">
                        <label for="authEmail">Email Address:</label>
                        <input type="email" id="authEmail" name="authEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="authPassword">Password:</label>
                        <input type="password" id="authPassword" name="authPassword" required placeholder="Enter your password (min. 6 characters)">
                    </div>
                </form>
                <div class="auth-divider">OR</div>
            </div>
            <div class="modal-footer">
                <button type="button" id="loginBtn" class="btn-cta">Login with Email</button>
                <button type="button" id="signupBtn" class="btn-cta btn-secondary">Sign Up with Email</button>
                <button type="button" id="googleSignInBtn" class="btn-cta btn-google-signin"><i class="fab fa-google"></i>Sign in with Google</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="#" class="bottom-nav-item active" id="navHome"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="#" class="bottom-nav-item" id="navOrders"><i class="fas fa-shopping-bag"></i><span>Cart</span></a>
        <a href="#" class="bottom-nav-item" id="navSettings"><i class="fas fa-cog"></i><span>Setting</span></a>
    </nav>

    <script>
        // --- START OF YOUR FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyD7pEI9WTNjMircinyK_dBSyXhKNurth98",
            authDomain: "christian-shopping-805b8.firebaseapp.com",
            databaseURL: "https://christian-shopping-805b8-default-rtdb.firebaseio.com",
            projectId: "christian-shopping-805b8",
            storageBucket: "christian-shopping-805b8.appspot.com",
            messagingSenderId: "909600369372",
            appId: "1:909600369372:web:1871ab693fd748c9a56219",
            measurementId: "G-85XPBKJTMK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        // --- END OF YOUR FIREBASE CONFIGURATION ---


        document.addEventListener('DOMContentLoaded', () => {
            const bodyElement = document.body;
            const bottomNavElement = document.querySelector('.bottom-nav');
            
            const categoriesContainer = document.getElementById('categories-container');
            const productsContainer = document.getElementById('products-container');
            const productsSectionTitleEl = document.getElementById('products-section-title');
            const mainSectionTitleEl = document.getElementById('main-section-title');
            
            const productDetailModalEl = document.getElementById('productDetailModal');
            const modalProductInfo = document.getElementById('modal-product-info');
            const orderNowFromDetailBtn = document.getElementById('orderNowFromDetailBtn');
            
            const orderFormModalEl = document.getElementById('orderFormModal'); 
            const orderForm = document.getElementById('orderForm');
            const formProductIdInput = document.getElementById('formProductId');
            const customerNameInput = document.getElementById('customerName');
            const customerMobileInput = document.getElementById('customerMobile'); 
            const customerEmailInput = document.getElementById('customerEmail'); 
            const customerPincodeInput = document.getElementById('customerPincode');
            const customerPostOfficeSelect = document.getElementById('customerPostOffice');
            const customerDistrictInput = document.getElementById('customerDistrict');
            const customerStateInput = document.getElementById('customerState');
            const customerVillageLandmarkInput = document.getElementById('customerVillageLandmark');
            const customerFullAddressInput = document.getElementById('customerFullAddress');
            const pincodeStatusDiv = document.getElementById('pincodeStatus');

            const myOrdersModalEl = document.getElementById('myOrdersModal'); 
            const ordersListContainer = document.getElementById('ordersListContainer');
            
            const settingsModalEl = document.getElementById('settingsModal');

            const headerCartBtn = document.getElementById('headerCartBtn');
            const navHome = document.getElementById('navHome');
            const navOrders = document.getElementById('navOrders');
            const navSettings = document.getElementById('navSettings');

            // --- Auth State and Elements ---
            let isLoggedIn = false;
            let currentUserEmail = null; // Can also be from Google
            let currentUserName = null; // For Google display name

            const authModalEl = document.getElementById('authModal');
            const authEmailInput = document.getElementById('authEmail');
            const authPasswordInput = document.getElementById('authPassword');
            const loginBtn = document.getElementById('loginBtn');
            const signupBtn = document.getElementById('signupBtn');
            const googleSignInBtn = document.getElementById('googleSignInBtn'); // Google Sign-In button

            const btnAuthAction = document.getElementById('btnAuthAction'); 
            const profileDetailsTextEl = document.getElementById('profileDetailsText');
            const loggedInUserInfoEl = document.getElementById('loggedInUserInfo');
            
            const products = [
                { id: 1, name: "iPhone 12", category: "Electronics", image: "images/iphone12.png", price: "₹76500", description: "A14 Bionic chip...", colors: [{name: 'Purple', code: '#A076DA'}, {name: 'Blue', code: '#3B5998'}], sizes: ['128GB', '256GB'] },
                { id: 2, name: "Hoodie Yellow", category: "Apparel", image: "images/hoodie-yellow.png", price: "₹6900", description: "Oversized hoodie...", colors: [{name: 'Yellow', code: '#FFD700'}, {name: 'Orange', code: '#FFA500'}], sizes: ['S','M', 'L', 'XL'] },
                { id: 3, name: "Apple Watch 6", category: "Wearables", image: "images/applewatch6.png", price: "₹39500", description: "Measure blood oxygen...", colors: [{name: 'Space Gray', code: '#5A5A5A'}, {name: 'Silver', code: '#C0C0C0'}], sizes: ['40mm', '44mm'] },
                { id: 4, name: "Men Shoes", category: "Footwear", image: "images/menshoes.png", price: "₹4500", description: "Comfortable sneakers...", colors: [{name: 'Grey', code: '#808080'}, {name: 'Black', code: '#000000'}], sizes: ['8', '9', '10'] },
                { id: 5, name: "Holy Bible (KJV)", category: "Books", image: "images/bible.jpg", price: "₹499", description: "King James Version...", colors: [], sizes: ['Standard', 'Large Print'] },
                { id: 6, name: "Cross Pendant Necklace", category: "Jewelry", image: "images/cross-necklace.jpg", price: "₹299", description: "Elegant silver-plated cross...", colors: [], sizes: ['One Size'] }
            ];
            let orders = JSON.parse(localStorage.getItem('onlineStoreOrders')) || [];
            let currentPincodeData = null; 

            // --- FIREBASE AUTH FUNCTIONS ---
            const googleProvider = new firebase.auth.GoogleAuthProvider();
            // Optional: Add scopes if needed, e.g., to get more profile info
            // googleProvider.addScope('profile');
            // googleProvider.addScope('email');


            auth.onAuthStateChanged((user) => {
                if (user) {
                    isLoggedIn = true;
                    currentUserEmail = user.email; 
                    currentUserName = user.displayName || user.email; // Use displayName if available from Google
                    console.log("User logged in:", currentUserEmail, "Name:", currentUserName);
                } else {
                    isLoggedIn = false;
                    currentUserEmail = null;
                    currentUserName = null;
                    console.log("User logged out");
                }
                updateAuthUI();
            });

            function updateAuthUI() {
                if (!btnAuthAction || !profileDetailsTextEl || !loggedInUserInfoEl) return;

                if (isLoggedIn && currentUserName) {
                    btnAuthAction.textContent = 'Logout';
                    btnAuthAction.classList.remove('btn-signup-settings'); 
                    btnAuthAction.classList.add('btn-logout-settings');
                    
                    profileDetailsTextEl.style.display = 'none';
                    loggedInUserInfoEl.textContent = `Logged in as: ${currentUserName}`;
                    loggedInUserInfoEl.style.display = 'block';
                    
                    if (customerEmailInput && currentUserEmail) { 
                        customerEmailInput.value = currentUserEmail;
                    }
                    if (customerNameInput && user.displayName && !customerNameInput.value) { // Prefill name if Google provided it
                        customerNameInput.value = user.displayName;
                    }
                } else {
                    btnAuthAction.textContent = 'Sign up / Login';
                    btnAuthAction.classList.add('btn-signup-settings');
                    btnAuthAction.classList.remove('btn-logout-settings');

                    profileDetailsTextEl.textContent = 'Sign up or login to manage your orders and profile.';
                    profileDetailsTextEl.style.display = 'block';
                    loggedInUserInfoEl.style.display = 'none';

                    if (customerEmailInput) customerEmailInput.value = ''; 
                    // Do not clear customerNameInput automatically on logout, user might have typed it
                }
            }

            function handleAuthActionClick() {
                 if (isLoggedIn) { 
                    if (confirm("Are you sure you want to logout?")) {
                        auth.signOut().then(() => {
                            alert("You have been logged out.");
                        }).catch((error) => {
                            console.error("Logout Error:", error);
                            alert("Error logging out: " + error.message);
                        });
                    }
                } else { 
                    closeModal('settingsModal', true); 
                    openModal('authModal');
                    if(authEmailInput) authEmailInput.value = ''; 
                    if(authPasswordInput) authPasswordInput.value = '';
                }
            }

            if (btnAuthAction) {
                btnAuthAction.addEventListener('click', handleAuthActionClick);
            }

            if (loginBtn) {
                loginBtn.addEventListener('click', () => {
                    const email = authEmailInput.value.trim();
                    const password = authPasswordInput.value.trim();
                    if (!email || !password) { alert("Please enter both email and password."); return; }
                    
                    setAuthButtonsLoading(true, 'Logging in...');
                    auth.signInWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            alert("Successfully logged in!");
                            closeModal('authModal');
                        })
                        .catch((error) => {
                            console.error("Login error:", error);
                            alert("Login failed: " + error.message);
                        })
                        .finally(() => setAuthButtonsLoading(false));
                });
            }

            if (signupBtn) {
                signupBtn.addEventListener('click', () => {
                    const email = authEmailInput.value.trim();
                    const password = authPasswordInput.value.trim();
                    if (!email || !password) { alert("Please enter both email and password."); return; }
                    if (password.length < 6) { alert("Password should be at least 6 characters long."); return; }

                    setAuthButtonsLoading(true, 'Signing up...');
                    auth.createUserWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            alert("Successfully signed up and logged in!");
                            closeModal('authModal');
                        })
                        .catch((error) => {
                            console.error("Sign up error:", error);
                            alert("Sign up failed: " + error.message);
                        })
                        .finally(() => setAuthButtonsLoading(false));
                });
            }

            if (googleSignInBtn) {
                googleSignInBtn.addEventListener('click', () => {
                    setAuthButtonsLoading(true, 'Connecting to Google...');
                    auth.signInWithPopup(googleProvider)
                        .then((result) => {
                            const user = result.user;
                            console.log("Signed in with Google:", user.displayName, user.email);
                            alert(`Successfully signed in with Google as ${user.displayName || user.email}!`);
                            closeModal('authModal');
                        }).catch((error) => {
                            console.error("Google Sign-In Error:", error);
                            if (error.code === 'auth/account-exists-with-different-credential') {
                                alert("An account already exists with this email address using a different sign-in method. Please sign in using that method first, or use a different Google account.");
                                // More sophisticated linking could be implemented here
                            } else {
                                alert("Google Sign-In Failed: " + error.message);
                            }
                        }).finally(() => setAuthButtonsLoading(false));
                });
            }
            
            function setAuthButtonsLoading(isLoading, message = '') {
                if (loginBtn) {
                    loginBtn.disabled = isLoading;
                    if (isLoading) loginBtn.textContent = message || 'Processing...';
                    else loginBtn.textContent = 'Login with Email';
                }
                if (signupBtn) {
                    signupBtn.disabled = isLoading;
                    if (isLoading) signupBtn.textContent = message || 'Processing...';
                    else signupBtn.textContent = 'Sign Up with Email';
                }
                if (googleSignInBtn) {
                    googleSignInBtn.disabled = isLoading;
                    if (isLoading) googleSignInBtn.innerHTML = `<i class="fab fa-google"></i> ${message || 'Processing...'}`;
                    else googleSignInBtn.innerHTML = '<i class="fab fa-google"></i>Sign in with Google';
                }
            }


            // --- PINCODE LOGIC --- 
            if(customerPincodeInput) { 
                customerPincodeInput.addEventListener('input', function() {
                    const pincode = this.value;
                    customerPostOfficeSelect.innerHTML = '<option value="">-- Select Post Office --</option>';
                    customerDistrictInput.value = ''; customerStateInput.value = '';
                    pincodeStatusDiv.textContent = ''; pincodeStatusDiv.className = 'pincode-status';
                    currentPincodeData = null;
                    customerPostOfficeSelect.disabled = true;
                    if (pincode.length === 6) fetchPincodeDetails(pincode);
                    else if (pincode.length > 0) { pincodeStatusDiv.textContent = 'Pincode must be 6 digits.'; pincodeStatusDiv.classList.add('error');}
                });
                customerPostOfficeSelect.addEventListener('change', function() {
                    const selectedPostOfficeName = this.value;
                    if (currentPincodeData && selectedPostOfficeName) {
                        const selectedOffice = currentPincodeData.find(office => office.Name === selectedPostOfficeName);
                        if (selectedOffice) {
                            customerDistrictInput.value = selectedOffice.District || '';
                            customerStateInput.value = selectedOffice.State || '';
                        }
                    } else {
                        customerDistrictInput.value = ''; customerStateInput.value = '';
                    }
                });
            }
            async function fetchPincodeDetails(pincode) {
                pincodeStatusDiv.textContent = 'Fetching details...'; pincodeStatusDiv.classList.add('loading');
                const apiUrl = `https://api.postalpincode.in/pincode/${pincode}`;
                try {
                    const response = await fetch(apiUrl); const data = await response.json();
                    if (data && data.length > 0 && data[0].Status === "Success") {
                        currentPincodeData = data[0].PostOffice;
                        customerPostOfficeSelect.innerHTML = '<option value="">-- Select Post Office --</option>';
                        currentPincodeData.forEach(office => {
                            const option = document.createElement('option');
                            option.value = office.Name; option.textContent = office.Name;
                            customerPostOfficeSelect.appendChild(option);
                        });
                        customerPostOfficeSelect.disabled = false;
                        pincodeStatusDiv.textContent = `Found ${currentPincodeData.length} post office(s). Please select one.`;
                        pincodeStatusDiv.className = 'pincode-status success';
                    } else {
                        currentPincodeData = null;
                        pincodeStatusDiv.textContent = (data && data[0] && data[0].Message) || 'Pincode details not found.';
                        pincodeStatusDiv.className = 'pincode-status error';
                    }
                } catch (error) {
                    currentPincodeData = null; console.error('Error fetching pincode:', error);
                    pincodeStatusDiv.textContent = 'Error fetching. Try again.'; pincodeStatusDiv.className = 'pincode-status error';
                }
            }

            // --- RENDER CATEGORIES & PRODUCTS --- 
            function renderCategories() {
                const uniqueCategories = ['All', ...new Set(products.map(p => p.category))];
                if (!categoriesContainer) return;
                categoriesContainer.innerHTML = '';
                uniqueCategories.forEach(category => {
                    const button = document.createElement('button');
                    button.classList.add('category-btn'); button.textContent = category;
                    if (category === 'All') button.classList.add('active');
                    button.addEventListener('click', () => {
                        filterProductsByCategory(category);
                        document.querySelectorAll('#categories-container .category-btn').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                    });
                    categoriesContainer.appendChild(button);
                });
            }
            function renderProducts(filterCategory = 'All') {
                if (!productsContainer || !productsSectionTitleEl) return;
                productsContainer.innerHTML = '';
                productsSectionTitleEl.textContent = filterCategory === 'All' ? 'All Products' : filterCategory;
                const filteredProducts = filterCategory === 'All' ? products : products.filter(p => p.category === filterCategory);
                if (filteredProducts.length === 0) {
                    productsContainer.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-color-secondary); padding: 20px;">No products found.</p>';
                    return;
                }
                let cardBgIndex = 0; 
                const cardBackgrounds = ['var(--card-bg-1)','var(--card-bg-2)','var(--card-bg-3)','var(--card-bg-4)'];
                filteredProducts.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.classList.add('product-card');
                    productCard.style.backgroundColor = cardBackgrounds[cardBgIndex % cardBackgrounds.length];
                    cardBgIndex++;
                    productCard.dataset.productId = product.id;
                    productCard.innerHTML = `
                        <div class="product-image-container" data-action="view-details">
                            <img src="${product.image}" alt="${product.name}">
                            <i class="far fa-heart wishlist-icon" data-action="toggle-wishlist"></i>
                        </div>
                        <div class="product-card-content">
                            <h3 class="product-title" data-action="view-details">${product.name}</h3>
                            <div class="product-info-bottom">
                                <p class="product-price">${product.price}</p>
                                <button class="buy-btn" data-action="view-details">Buy</button>
                            </div>
                        </div>`;
                    productsContainer.appendChild(productCard);
                });
            }
            if(productsContainer) {
                productsContainer.addEventListener('click', function(event) {
                    const targetElement = event.target.closest('[data-action]');
                    if (!targetElement) return;
                    const action = targetElement.dataset.action;
                    const card = targetElement.closest('.product-card');
                    if (action === 'view-details') {
                        if (card && card.dataset.productId) showProductDetail(parseInt(card.dataset.productId));
                    } else if (action === 'toggle-wishlist') {
                        if (targetElement.classList.contains('wishlist-icon')) {
                             targetElement.classList.toggle('fas'); targetElement.classList.toggle('far');
                             targetElement.classList.toggle('active');
                        }
                    }
                });
            }
            function filterProductsByCategory(category) { renderProducts(category); }

            // --- SHOW PRODUCT DETAIL & ORDER FORM --- 
             function showProductDetail(productId) {
                const product = products.find(p => p.id === productId); if (!product) return;
                let colorsHtml = '';
                if (product.colors && product.colors.length > 0) {
                    colorsHtml = `<div class="option-group"><span class="option-label">Color:</span><div class="option-buttons">${product.colors.map((color, index) => `<span class="color-dot ${index === 0 ? 'selected' : ''}" style="background-color: ${color.code};" title="${color.name}" data-color="${color.name}"></span>`).join('')}</div></div>`;
                }
                let sizesHtml = '';
                if (product.sizes && product.sizes.length > 0) {
                    sizesHtml = `<div class="option-group"><span class="option-label">Size:</span><div class="option-buttons">${product.sizes.map((size, index) => `<button class="option-btn ${index === 0 ? 'selected' : ''}" data-size="${size}">${size}</button>`).join('')}</div></div>`;
                }
                modalProductInfo.innerHTML = `
                    <div class="product-detail-image-wrapper"><img src="${product.image}" alt="${product.name}" class="product-detail-image"></div>
                    <div class="product-detail-content">
                        <h3 class="detail-title">${product.name}</h3><p class="detail-price">${product.price}</p>
                        <p class="stock-status"><i class="fas fa-check-circle"></i> Available in Stock</p>
                        <div class="product-options">${colorsHtml}${sizesHtml}</div>
                        <h4 class="description-title">Description</h4><p class="description-text">${product.description}</p>
                    </div>`;
                orderNowFromDetailBtn.dataset.productId = productId; 
                openModal('productDetailModal'); 
            }
            if(orderNowFromDetailBtn) {
                orderNowFromDetailBtn.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.dataset.productId); 
                    closeModal('productDetailModal'); 
                    showOrderForm(productId);
                });
            }
            function showOrderForm(productId) {
                if (!orderForm || !formProductIdInput || !customerPostOfficeSelect || !customerDistrictInput || !customerStateInput || !pincodeStatusDiv) return;
                formProductIdInput.value = productId; 
                orderForm.reset(); 
                
                const user = auth.currentUser; // Get current user from Firebase
                if (user) {
                    if (customerEmailInput && user.email) { 
                        customerEmailInput.value = user.email;
                    }
                    if (customerNameInput && user.displayName && !customerNameInput.value) { // If name field is empty, prefill from Google
                        customerNameInput.value = user.displayName;
                    }
                    // Mobile number is not directly available from Google/Email auth, user needs to type it
                }


                customerPostOfficeSelect.innerHTML = '<option value="">-- Select Post Office --</option>';
                customerDistrictInput.value = ''; customerStateInput.value = '';
                pincodeStatusDiv.textContent = ''; pincodeStatusDiv.className = 'pincode-status';
                currentPincodeData = null; customerPostOfficeSelect.disabled = true;
                openModal('orderFormModal'); 
            }
            function handleOrderSubmit(event) {
                event.preventDefault();
                if (!formProductIdInput || !customerNameInput || !customerMobileInput || !customerPincodeInput || !customerPostOfficeSelect || !customerDistrictInput || !customerStateInput || !customerVillageLandmarkInput || !customerFullAddressInput) return;

                const productId = parseInt(formProductIdInput.value); const product = products.find(p => p.id === productId);
                const name = customerNameInput.value.trim(); 
                const mobile = customerMobileInput.value.trim(); 
                const orderEmail = customerEmailInput.value.trim(); 
                const pincode = customerPincodeInput.value.trim(); 
                const selectedPostOffice = customerPostOfficeSelect.value.trim();
                const district = customerDistrictInput.value.trim(); 
                const state = customerStateInput.value.trim();
                const villageLandmark = customerVillageLandmarkInput.value.trim(); 
                const fullAddress = customerFullAddressInput.value.trim();

                if (!name || !mobile || !pincode || !selectedPostOffice || !district || !state || !villageLandmark || !fullAddress) { alert("Please fill all required delivery details."); return; }
                if (!/^\d{10}$/.test(mobile)) { alert("Valid 10-digit mobile needed for delivery."); return; } 
                if (!/^\d{6}$/.test(pincode)) { alert("Valid 6-digit pincode needed."); return; }
                if (orderEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(orderEmail)) { 
                    alert("Please enter a valid contact email address.");
                    return;
                }

                const user = auth.currentUser;
                const newOrder = { 
                    orderId: Date.now(), productId, productName: product.name, productImage: product.image,
                    customerDetails: { name, mobile, email: orderEmail, pincode, postOffice: selectedPostOffice, district, state, villageLandmark, fullAddress },
                    orderDate: new Date().toLocaleDateString(),
                    orderedBy: user ? user.email : 'guest', // Store user's email from Firebase
                    userId: user ? user.uid : null // Store Firebase User ID
                };
                orders.push(newOrder); localStorage.setItem('onlineStoreOrders', JSON.stringify(orders));
                alert(`Thank you, ${name}! Your order for ${product.name} placed.`);
                closeModal('orderFormModal'); if (myOrdersModalEl && myOrdersModalEl.style.display === 'block') renderMyOrders();
            }
            if (orderForm) {
                orderForm.addEventListener('submit', handleOrderSubmit);
            }
            function renderMyOrders() { 
                if (!ordersListContainer) return;
                ordersListContainer.innerHTML = ''; 
                if (orders.length === 0) {
                    ordersListContainer.innerHTML = '<p class="no-orders">No orders yet.</p>'; 
                    return;
                }
                orders.slice().reverse().forEach(order => { 
                    const item = document.createElement('div'); item.classList.add('order-item');
                    const d = order.customerDetails;
                    let addr = 'N/A';
                    if (d) {
                        addr = `${d.fullAddress || ''}${d.villageLandmark ? ', ' + d.villageLandmark : ''}${d.postOffice ? ', ' + d.postOffice : ''}${d.district ? ', ' + d.district : ''}${d.state ? ', ' + d.state : ''}${d.pincode ? ' - ' + d.pincode : ''}`;
                    }
                    item.innerHTML = `
                        <div style="display:flex; align-items:center; gap:15px;">
                            <img src="${order.productImage}" alt="${order.productName}" style="width:60px; height:60px; object-fit:contain; border-radius:8px;">
                            <div>
                                <h4 style="margin-bottom:5px; font-size:1rem;">${order.productName}</h4>
                                <p style="font-size:0.8rem; color:var(--text-color-secondary);">ID: ${order.orderId}</p>
                                <p style="font-size:0.8rem; color:var(--text-color-secondary);">To: ${d ? d.name : 'N/A'}</p>
                                ${d && d.email ? `<p style="font-size:0.8rem; color:var(--text-color-secondary);">Email: ${d.email}</p>` : ''}
                                <p style="font-size:0.8rem; color:var(--text-color-secondary);">Address: ${addr}</p>
                                ${order.orderedBy && order.orderedBy !== 'guest' ? `<p style="font-size:0.75rem; color:var(--accent-color); word-break:break-all;">User: ${order.orderedBy}</p>` : ''}
                            </div>
                        </div>`;
                    ordersListContainer.appendChild(item);
                });
            }

            // --- MODAL open/close functions --- 
            window.openModal = (id) => {
                const modalToOpen = document.getElementById(id);
                if (!modalToOpen) return;
                modalToOpen.style.display = 'block';
                bodyElement.classList.add('modal-open');

                if (id === 'productDetailModal' || id === 'authModal' ) { 
                    bottomNavElement.classList.add('is-hidden');
                    bodyElement.classList.add('no-bottom-padding');
                } else {
                    bottomNavElement.classList.remove('is-hidden');
                    bodyElement.classList.remove('no-bottom-padding');
                }
            };
            window.closeModal = (id, calledInternally = false) => {
                const modalToClose = document.getElementById(id);
                if (!modalToClose) return;
                modalToClose.style.display = 'none';
                
                if (!calledInternally) {
                    const anyModalOpen = Array.from(document.querySelectorAll('.modal')).some(m => m.style.display === 'block');
                    if (!anyModalOpen) {
                        bodyElement.classList.remove('modal-open');
                    }
                }
                
                let shouldShowNav = true;
                const fullScreenModals = ['productDetailModal', 'authModal'];
                if (fullScreenModals.some(modalId => {
                    const modalEl = document.getElementById(modalId);
                    return modalEl && modalEl.style.display === 'block';
                })) {
                    shouldShowNav = false;
                }

                if(shouldShowNav){
                    bottomNavElement.classList.remove('is-hidden');
                    bodyElement.classList.remove('no-bottom-padding');
                } else {
                     bottomNavElement.classList.add('is-hidden'); 
                     bodyElement.classList.add('no-bottom-padding');
                }
            };
            window.onclick = (e) => { 
                if (e.target.classList.contains('modal') && e.target.id) {
                    closeModal(e.target.id); 
                }
            }
            const closeAllModals = (exceptIds = []) => { 
                document.querySelectorAll('.modal').forEach(m => {
                    if (m.style.display === 'block' && !exceptIds.includes(m.id)) { 
                        closeModal(m.id, true); 
                    }
                }); 
                const anyFullScreenModalOpen = ['productDetailModal', 'authModal'].some(id => {
                    const modalEl = document.getElementById(id);
                    return modalEl && modalEl.style.display === 'block';
                });

                if (!anyFullScreenModalOpen) {
                    bodyElement.classList.remove('modal-open'); 
                    bottomNavElement.classList.remove('is-hidden');
                    bodyElement.classList.remove('no-bottom-padding');
                } else {
                    bodyElement.classList.add('modal-open');
                }
            }
            const updateBottomNav = (activeId) => {
                 document.querySelectorAll('.bottom-nav-item').forEach(i => {
                    i.classList.remove('active');
                    i.removeAttribute('aria-current'); 
                 });
                 const activeNavItem = document.getElementById(activeId);
                 if(activeNavItem) {
                    activeNavItem.classList.add('active');
                    activeNavItem.setAttribute('aria-current', 'page'); 
                 }
            }

            // --- NAVIGATION EVENT LISTENERS ---
            const showMyOrdersView = () => { 
                closeAllModals(['myOrdersModal']); 
                renderMyOrders(); 
                openModal('myOrdersModal'); 
                updateBottomNav('navOrders'); 
            }
            const showSettingsView = () => { 
                closeAllModals(['settingsModal']); 
                openModal('settingsModal');
                updateBottomNav('navSettings');
            }

            if(headerCartBtn) headerCartBtn.addEventListener('click', showMyOrdersView);
            
            if(navOrders) navOrders.addEventListener('click', (e) => { 
                e.preventDefault(); 
                showMyOrdersView(); 
            });
            
            if(navHome) navHome.addEventListener('click', (e) => {
                e.preventDefault();
                closeAllModals(); 
                updateBottomNav('navHome');
                document.querySelectorAll('#categories-container .category-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.textContent === 'All') {
                        btn.classList.add('active');
                    }
                });
                renderProducts('All');
                if(mainSectionTitleEl) mainSectionTitleEl.textContent = 'Recommendations';
            });

            if(navSettings) navSettings.addEventListener('click', (e) => { 
                e.preventDefault(); 
                showSettingsView(); 
            });
            
            document.getElementById('settingsShareBtn')?.addEventListener('click', () => alert('Share App clicked!'));
            document.getElementById('settingsContactBtn')?.addEventListener('click', () => alert('Contact Us clicked!'));
            document.getElementById('settingsPrivacyBtn')?.addEventListener('click', () => alert('Privacy Policy clicked!'));
            
            // Initial Renders
            renderCategories(); 
            renderProducts(); 
            updateBottomNav('navHome');
        });
    </script>
</body>
</html>
